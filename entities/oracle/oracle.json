{
  "$meta": {
    "name": "Oracle",
    "version": "1.0.0",
    "issued": "2025-10-11T00:00:00Z",
    "description": "Unified Oracle engine: fact-based world-event reasoning with optional symbolic overlays. One file to rule it."
  },
  "engine": {
    "calibration": {
      "bias": 0.0,
      "scale": 1.0
    },
    "guard": {
      "allow_domains": [],
      "deny_domains": [],
      "max_docs": 20
    },
    "personalization": {
      "enabled": true,
      "boost": 0.15,
      "fields": [
        "title",
        "summary",
        "tags",
        "entities"
      ],
      "about_me_keywords": [
        "alias",
        "aci",
        "willow"
      ]
    },
    "thresholds": {
      "tipper": {
        "hi": 0.70,
        "lo": 0.60
      },
      "deduper_cooldown_s": 1800
    },
    "io_contracts": {
      "world_event_input": {
        "type": "object",
        "required": [
          "docs",
          "aoi",
          "time"
        ],
        "properties": {
          "docs": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "doc_id": {
                  "type": "string"
                },
                "url": {
                  "type": "string"
                },
                "title": {
                  "type": "string"
                },
                "summary": {
                  "type": "string"
                },
                "tags": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "lat": {
                  "type": "number"
                },
                "lon": {
                  "type": "number"
                }
              },
              "required": [
                "doc_id",
                "url",
                "title"
              ]
            }
          },
          "aoi": {
            "type": "object"
          },
          "time": {
            "type": "object",
            "properties": {
              "start": {
                "type": "string"
              },
              "end": {
                "type": "string"
              }
            }
          }
        }
      },
      "world_event_output": {
        "type": "object",
        "required": [
          "predictions",
          "provenance"
        ],
        "properties": {
          "predictions": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "aoi": {
                  "type": "object"
                },
                "time": {
                  "type": "object"
                },
                "score": {
                  "type": "number"
                },
                "tip": {
                  "type": "boolean"
                },
                "features": {
                  "type": "object",
                  "properties": {
                    "personal_relevance": {
                      "type": "number"
                    },
                    "recency": {
                      "type": "number"
                    },
                    "proximity": {
                      "type": "number"
                    },
                    "source_trust": {
                      "type": "number"
                    }
                  }
                },
                "evidence": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "doc_id": {
                        "type": "string"
                      },
                      "url": {
                        "type": "string"
                      },
                      "why": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              },
              "required": [
                "score",
                "features"
              ]
            }
          },
          "provenance": {
            "type": "object",
            "properties": {
              "nodes_used": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "time_context": {
                "type": "object",
                "properties": {
                  "ts": {
                    "type": "string"
                  }
                }
              }
            },
            "required": [
              "nodes_used"
            ]
          }
        }
      }
    }
  },
  "overlay": {
    "enabled": true,
    "min_results": 3,
    "ask_on_missing": true,
    "discovery": {
      "extension_registry_ref": "oracle_extensions.json",
      "file_glob": "extensions/*.json",
      "auto_hook": true,
      "non_blocking": true
    },
    "policy": {
      "require_data_backing_for_symbolic_output": true,
      "fallback_to_reason_if_no_data": true
    }
  },
  "routes": [
    {
      "if": "type=='SEARCH_QUERY'",
      "to": [
        "search_proxy"
      ]
    },
    {
      "if": "type=='SEARCH_RESULT' and not payload.get('filtered')",
      "to": [
        "policy_guard",
        "oracle_engine"
      ]
    },
    {
      "if": "type=='SEARCH_RESULT' and payload.get('filtered')",
      "to": [
        "oracle_engine"
      ]
    },
    {
      "if": "type in ['OBS','WORLD_EVENT']",
      "to": [
        "oracle_engine"
      ]
    },
    {
      "if": "type=='PRED'",
      "to": [
        "fusion",
        "tipper"
      ]
    },
    {
      "if": "type=='PRED_FUSED'",
      "to": [
        "tipper"
      ]
    },
    {
      "if": "type=='TIP'",
      "to": [
        "deduper",
        "scheduler"
      ]
    },
    {
      "if": "type=='CUE'",
      "to": [
        "executor"
      ]
    },
    {
      "if": "type=='ASK'",
      "to": []
    }
  ],
  "assets": [
    {
      "name": "oracle-worker-1",
      "capacity_per_tick": 1,
      "base_cost": 0.05,
      "move_penalty": 0.03
    },
    {
      "name": "oracle-worker-2",
      "capacity_per_tick": 1,
      "base_cost": 0.05,
      "move_penalty": 0.03
    }
  ]
}
